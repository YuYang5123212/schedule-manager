<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>我的日程管理</title>
    <!-- 网页图标 (Favicon) -->
    <link rel="icon" href="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f4c5.png" type="image/png">

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <link rel="stylesheet" href="style.css?v=5.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- 顶部 -->
    <div class="top-bar">
        <div class="logo">📅 个人日程</div>
        <div id="status" class="status-badge">连接中...</div>
    </div>

    <!-- 主布局 -->
    <div class="main-layout">
        <div class="calendar-section fade-anim" id="calendar-container">
            <div id='calendar'></div>
        </div>

        <div class="sidebar-section">
            <h3>📌 待办与备注</h3>
            <div id="task-list" class="task-container">
                <p style="color:#999; text-align:center;">加载中...</p>
            </div>
        </div>
    </div>

    <!-- 🟢 全新设计的弹窗 -->
    <div id="eventModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3 id="modalTitle">新建日程</h3>

            <!-- 1. 标题 -->
            <div class="input-group">
                <label>日程内容</label>
                <input type="text" id="eventTitleInput" placeholder="例如：高数课" autocomplete="off">
            </div>

            <!-- 2. 备注 -->
            <div class="input-group">
                <label>备注详情</label>
                <input type="text" id="eventDescInput" placeholder="例如：教2-101，张老师" autocomplete="off">
            </div>

            <!-- 3. 自定义标签系统 -->
            <div class="input-group">
                <label>选择标签</label>
                <div id="tags-container" class="tags-wrapper">
                    <!-- JS 会在这里生成标签 -->
                </div>
                <!-- 添加新标签的按钮 -->
                <div class="add-tag-trigger" onclick="toggleTagForm()">+ 新建标签</div>

                <!-- 新建标签的小表单 (默认隐藏) -->
                <div id="new-tag-form"
                    style="display:none; margin-top:10px; padding:10px; background:#f5f5f5; border-radius:8px;">
                    <input type="text" id="newTagName" placeholder="标签名 (如: 社团)" style="width:60%; font-size:12px;">
                    <input type="color" id="newTagColor" value="#4a90e2"
                        style="width:30px; height:30px; border:none; vertical-align:middle;">
                    <button onclick="addNewTag()" style="font-size:12px; padding:4px 8px;">确定</button>
                </div>
            </div>

            <input type="hidden" id="eventStartInput">
            <input type="hidden" id="eventEndInput">
            <input type="hidden" id="eventIdInput">
            <input type="hidden" id="selectedTagColor"> <!-- 存储选中的颜色 -->

            <div class="modal-buttons">
                <button onclick="closeModal()" class="btn-cancel">取消</button>
                <button onclick="deleteCurrentEvent()" id="btnDelete" class="btn-delete"
                    style="display:none;">删除</button>
                <button onclick="saveEvent()" class="btn-save">保存</button>
            </div>
        </div>
    </div>

    <!-- 悬浮按钮 -->
    <div id="fab-container" class="fab-container">
        <div class="fab-options">
            <button class="fab-btn sub-btn" onclick="changeView('multiMonthYear')" title="年历"><i
                    class="fas fa-calendar"></i></button>
            <button class="fab-btn sub-btn" onclick="changeView('dayGridMonth')" title="月历"><i
                    class="fas fa-calendar-alt"></i></button>
            <button class="fab-btn sub-btn" onclick="changeView('rollingWeek')" title="周视"><i
                    class="fas fa-columns"></i></button>
            <button class="fab-btn sub-btn" onclick="openCreateModal()" title="新建"><i class="fas fa-plus"></i></button>
        </div>
        <div class="fab-btn main-btn" id="fab-main">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <script type="module" src="script.js?v=5.0"></script>
</body>

</html>